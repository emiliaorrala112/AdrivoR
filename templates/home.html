{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Adrivo R.</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS GENERALES --- */
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #fff0f5; background-image: radial-gradient(#ffcce0 2px, transparent 2px); background-size: 25px 25px; overflow-x: hidden; color: #333; display: flex; flex-direction: column; min-height: 100vh; }

        /* HEADER */
        .sticky-header { position: sticky; top: 0; z-index: 1000; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(232, 62, 140, 0.15); }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding: 10px 40px; width: 100%; margin: 0 auto; }
        .brand-badge { text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .brand-badge img { height: 45px; width: 45px; border-radius: 50%; border: 2px solid #ff4b9a; padding: 2px; }
        .brand-badge span { font-family: 'Pacifico', cursive; font-size: 1.8rem; color: #ff4b9a; text-shadow: 1px 1px 0px #ffeebb; }

        .search-form { flex-grow: 1; max-width: 600px; margin: 0 30px; position: relative; }
        .search-input { width: 100%; padding: 12px 20px; border-radius: 50px; border: 2px solid #ffcce0; background: #fffbfd; outline: none; transition: 0.3s; color: #555; font-family: inherit; font-weight: 500;}
        .search-input:focus { background: white; border-color: #ff4b9a; box-shadow: 0 0 0 4px rgba(255, 75, 154, 0.1); }
        .search-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; color: #ff4b9a; cursor: pointer; font-size: 1.1rem; }

        .header-actions { display: flex; align-items: center; gap: 15px; }
        .btn-login-header { text-decoration: none; color: #ff4b9a; font-weight: 700; font-size: 0.9rem; border: 2px solid #ff4b9a; padding: 6px 18px; border-radius: 50px; transition: 0.3s; }
        .btn-login-header:hover { background: #fff0f6; }
        .btn-register-header { text-decoration: none; color: white; font-weight: 700; font-size: 0.9rem; background: linear-gradient(45deg, #ff4b9a, #ba68c8); padding: 8px 20px; border-radius: 50px; box-shadow: 0 4px 10px rgba(232, 62, 140, 0.3); transition: 0.3s; }
        .btn-register-header:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(232, 62, 140, 0.5); }
        .btn-panel { text-decoration: none; background-color: #333; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .btn-panel:hover { background-color: #ff4b9a; transform: translateY(-2px); }
        .btn-logout-icon { background: white; border: 1px solid #eee; width: 35px; height: 35px; border-radius: 50%; color: #666; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .btn-logout-icon:hover { background: #ff4b9a; color: white; border-color: #ff4b9a; }
        .icon-btn { position: relative; color: #555; font-size: 1.3rem; transition: 0.3s; margin-left: 5px; }
        .icon-btn:hover { color: #ff4b9a; transform: scale(1.1); }
        
        /* ESTILO CORREGIDO PARA EL NÚMERO ROJO */
        .count-pill { 
            position: absolute; top: -8px; right: -10px; 
            background: #ff4b9a; color: white; 
            font-size: 0.75rem; width: 20px; height: 20px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; border: 2px solid white; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* NAVEGACIÓN */
        .nav-categories { background: linear-gradient(90deg, #ff4b9a, #ba68c8); display: flex; justify-content: center; position: relative; flex-wrap: wrap; }
        .nav-item { position: relative; }
        .nav-link { display: block; text-decoration: none; color: white; font-weight: 700; font-size: 0.95rem; padding: 12px 30px; transition: 0.3s; letter-spacing: 0.5px; text-transform: uppercase; }
        .nav-link:hover { background: rgba(255,255,255,0.2); }
        .nav-link i { font-size: 0.8rem; margin-left: 5px; opacity: 0.8; }
        .mega-menu { display: none; position: absolute; top: 100%; left: 0; min-width: 400px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-top: 4px solid #ffd54f; z-index: 1000; padding: 20px; border-radius: 0 0 15px 15px; flex-direction: row; gap: 30px; flex-wrap: wrap; }
        .nav-item:hover .mega-menu { display: flex; }
        .mm-column { min-width: 120px; }
        .mm-title { color: #ff4b9a; font-weight: 800; font-size: 0.9rem; text-transform: uppercase; margin-bottom: 10px; border-bottom: 2px solid #ffe4f0; padding-bottom: 5px; display: block; }
        .mm-link { display: block; text-decoration: none; color: #666; font-size: 0.9rem; margin-bottom: 6px; transition: 0.2s; font-weight: 500; }
        .mm-link:hover { color: #ba68c8; transform: translateX(5px); font-weight: 700; }

        /* HEADER RESULTADOS DE BÚSQUEDA */
        .search-header-container { text-align: center; padding: 40px 20px; background: white; border-bottom: 1px solid #eee; margin-bottom: 30px; }
        .search-title { font-size: 2rem; text-transform: uppercase; font-weight: 800; color: #333; letter-spacing: 1px; }
        .search-count { color: #888; font-size: 1.2rem; font-weight: 400; }

        /* ESTADO VACÍO (NO RESULTADOS) */
        .no-results-state { text-align: center; padding: 80px 20px; color: #666; grid-column: 1 / -1; }
        .no-results-icon { font-size: 4rem; color: #ffcce0; margin-bottom: 20px; }
        .no-results-text { font-size: 1.5rem; font-weight: 600; margin-bottom: 10px; }
        .btn-reset-search { display: inline-block; margin-top: 15px; padding: 10px 25px; background: #ff4b9a; color: white; border-radius: 50px; text-decoration: none; font-weight: 700; transition: 0.3s; }
        .btn-reset-search:hover { background: #ba68c8; transform: translateY(-2px); }


        /* HERO & SLIDER */
        .wow-hero { background: linear-gradient(-45deg, #ff4b9a, #ba68c8, #ffd54f, #ff9a9e); background-size: 400% 400%; animation: gradientBG 10s ease infinite; min-height: 220px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; margin-bottom: 40px; position: relative; padding-bottom: 60px; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .hero-content h1 { font-size: 3.5rem; margin: 0; text-shadow: 0 4px 15px rgba(0,0,0,0.1); font-weight: 800; letter-spacing: -1px; }
        .hero-content p { font-size: 1.3rem; margin-top: 5px; opacity: 0.95; font-weight: 600; }
        .hero-wave { position: absolute; bottom: -1px; left: 0; width: 100%; overflow: hidden; line-height: 0; }
        .hero-wave svg { display: block; width: calc(100% + 1.3px); height: 50px; }
        .hero-wave path { fill: #fff0f5; }
        .slider-section { width: 95%; max-width: 1600px; margin: 20px auto 10px; position: relative; }
        .slider-title { text-align: center; color: #880e4f; margin-bottom: 20px; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 800; font-family: 'Pacifico', cursive; }
        .slider-container { display: flex; overflow-x: auto; gap: 20px; padding: 20px 5px; scroll-behavior: smooth; scroll-snap-type: x mandatory; scrollbar-width: none; }
        .slider-container::-webkit-scrollbar { display: none; }
        .slider-card { min-width: 220px; max-width: 220px; flex-shrink: 0; scroll-snap-align: start; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #fff0f6; transition: 0.3s; position: relative; }
        .slider-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(232, 62, 140, 0.2); }
        .slider-btn { position: absolute; top: 55%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 50%; background: white; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: #ff4b9a; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.3s; }
        .slider-btn:hover { background: #ff4b9a; color: white; }
        .prev-btn { left: -20px; } .next-btn { right: -20px; }
        .section-separator { display: flex; align-items: center; justify-content: center; margin: 50px auto 40px; width: 90%; max-width: 1000px; }
        .separator-line { flex: 1; height: 3px; background: linear-gradient(90deg, transparent, #ffcce0, transparent); border-radius: 5px; }
        .separator-content { padding: 0 25px; font-family: 'Pacifico', cursive; color: #ba68c8; font-size: 2rem; display: flex; align-items: center; gap: 15px; text-shadow: 2px 2px 0 #fff; }
        .separator-content i { font-size: 1.2rem; color: #ff4b9a; }

        /* CATALOGO */
        .container { width: 95%; max-width: 1600px; margin: 0 auto 50px; padding: 0 20px; flex: 1; }
        .catalog-wrapper { display: grid; grid-template-columns: 260px 1fr; gap: 40px; }
        .filter-sidebar { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 20px rgba(232, 62, 140, 0.05); border: 1px solid #fff0f6; }
        details.filter-group { margin-bottom: 25px; border-bottom: 1px dashed #ffdbe9; padding-bottom: 15px; }
        summary { font-weight: 800; color: #333; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; font-size: 1rem; margin-bottom: 15px; }
        summary::after { content: '\f078'; font-family: "Font Awesome 6 Free"; font-weight: 900; font-size: 0.8rem; color: #888; transition: 0.3s; }
        details[open] summary::after { transform: rotate(180deg); }
        .checkbox-item { display: flex; align-items: center; margin-bottom: 10px; cursor: pointer; color: #666; transition: 0.2s; padding-left: 10px; }
        .checkbox-item:hover { color: #ff4b9a; }
        .checkbox-item input[type="checkbox"] { accent-color: #ba68c8; width: 16px; height: 16px; margin-right: 10px; cursor: pointer; }
        .checkbox-label { font-size: 0.9rem; font-weight: 500; }
        .sub-level-title { font-weight: 700; color: #ba68c8; margin: 10px 0 5px; font-size: 0.85rem; text-transform: uppercase; padding-left: 5px; }
        .price-slider-container { padding: 10px 5px; text-align: center; }
        .range-slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 5px; background: #eee; outline: none; margin: 15px 0; }
        .range-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #ff4b9a; cursor: pointer; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: 0.2s; }
        .price-values { display: flex; justify-content: center; font-weight: 800; color: #ff4b9a; font-size: 1.1rem; }

        /* PRODUCTOS */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; }
        .product-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.05); transition: 0.3s; border: 1px solid #ffeaf2; position: relative; display: flex; flex-direction: column; height: 100%; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 35px rgba(232, 62, 140, 0.2); border-color: #ff4b9a; }
        .btn-fav-card { position: absolute; top: 12px; right: 12px; z-index: 10; background: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; color: #ccc; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.1); transition: 0.3s; font-size: 1.2rem; }
        .btn-fav-card:hover { transform: scale(1.1); }
        .btn-fav-card.active { color: #e040fb; background: #f3e5f5; border: 1px solid #e040fb; }
        .product-img { width: 100%; height: 260px; object-fit: cover; border-bottom: 3px solid #fff0f6; }
        .slider-card .product-img, .slider-card .no-img { height: 180px; }
        .no-img { width: 100%; height: 260px; background: #fff0f6; display: flex; align-items: center; justify-content: center; color: #ff4b9a; }
        .slider-card .no-img { height: 180px; }
        .product-info { padding: 20px; text-align: center; display: flex; flex-direction: column; flex-grow: 1; }
        
        .category-stack { margin-bottom: 8px; min-height: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .sub-tag { font-size: 0.75rem; color: #999; font-weight: 600; text-transform: uppercase; line-height: 1.2; }
        .type-tag { font-size: 0.85rem; color: #ba68c8; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; line-height: 1.2; }

        .product-title { color: #333; font-size: 1.1rem; font-weight: 700; margin: 0 0 8px; min-height: 45px; display: flex; align-items: center; justify-content: center; }
        .product-price { color: #e83e8c; font-size: 1.5rem; font-weight: 800; display: block; margin-bottom: 15px; }
        .qty-container { display: flex; align-items: center; justify-content: center; margin-bottom: 10px; gap: 10px; color: #666; font-size: 0.9rem; font-weight: 600; }
        .qty-input-card { width: 60px; padding: 5px; border: 2px solid #eee; border-radius: 50px; text-align: center; font-weight: 700; color: #333; outline: none; font-family: 'Poppins', sans-serif;}
        .btn-add-pink { width: 100%; background: linear-gradient(45deg, #ff4b9a, #ba68c8); color: white; border: none; padding: 12px; border-radius: 50px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(232, 62, 140, 0.3); margin-top: auto; }
        .btn-add-pink:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(232, 62, 140, 0.5); }
        .btn-buy-locked { display: block; width: 100%; padding: 12px; border-radius: 50px; background: #eee; color: #888; text-decoration: none; font-size: 0.85rem; font-weight: 600; margin-top: auto; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-buy-locked:hover { background: #e0e0e0; color: #666; }
        
        .notification-toast { position: fixed; top: 120px; right: 20px; background: white; padding: 12px 25px; border-radius: 50px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); border-left: 5px solid #ff4b9a; display: flex; align-items: center; gap: 10px; font-weight: 600; z-index: 9999; }
        .site-footer { background: white; border-top: 2px solid #fff0f6; padding: 30px; text-align: center; color: #999; font-size: 0.85rem; margin-top: 50px; font-weight: 600; }
        @media (max-width: 900px) { .catalog-wrapper { grid-template-columns: 1fr; } .header-top { padding: 10px 20px; flex-direction: column; gap: 15px;} .search-form { width: 100%; margin: 0; } .nav-categories { flex-wrap: wrap; } .prev-btn, .next-btn { display: none; } }
    </style>
</head>
<body>

    {% if messages %}
        {% for message in messages %}
        <div class="notification-toast"><i class="fas fa-check-circle" style="color:#2e7d32"></i> {{ message }}</div>
        {% endfor %}
    {% endif %}

    <header class="sticky-header">
        <div class="header-top">
            <a href="/" class="brand-badge">
                <img src="/static/logo_adrivo.jpg" alt="Logo">
                <span>Adrivo R.</span>
            </a>
            <form action="{% url 'home' %}" method="get" class="search-form">
                <div style="position:relative;">
                    <input type="text" name="q" placeholder="Buscar en el universo..." class="search-input" value="{{ query|default:'' }}">
                    <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
                </div>
            </form>
            <div class="header-actions">
                {% if user.is_authenticated %}
                    <span>Hola, {{ user.username }}</span>
                    {% if user.is_staff %}
                        <a href="/admin/" class="btn-panel" title="Panel Admin"><i class="fas fa-cogs"></i> Panel</a>
                    {% endif %}
                    <form action="{% url 'logout' %}" method="post" style="display:inline">
                        {% csrf_token %}
                        <button class="btn-logout-icon" title="Cerrar Sesión"><i class="fas fa-sign-out-alt"></i></button>
                    </form>
                {% else %}
                    <a href="{% url 'login' %}" class="btn-login-header">Iniciar Seción</a>
                    <a href="/registro/" class="btn-register-header">Registrarse</a>
                {% endif %}
                <a href="#" class="icon-btn"><i class="far fa-heart"></i></a>
                
                <a href="{% url 'carrito' %}" class="icon-btn">
                    <i class="fas fa-shopping-bag"></i>
                    {% if cantidad_carrito > 0 %}
                        <span class="count-pill">{{ cantidad_carrito }}</span>
                    {% endif %}
                </a>
            </div>
        </div>

        <nav class="nav-categories">
            <div class="nav-item"><a href="/" class="nav-link active">INICIO</a></div>
            {% for cat in categorias %}
            <div class="nav-item">
                <a href="#" class="nav-link">
                    {{ cat.nombre|upper }} 
                    {% if cat.subcategorias.all %}<i class="fas fa-chevron-down"></i>{% endif %}
                </a>
                {% if cat.subcategorias.all %}
                <div class="mega-menu">
                    {% for sub in cat.subcategorias.all %}
                    <div class="mm-column">
                        <span class="mm-title">{{ sub.nombre }}</span>
                        {% for tipo in sub.tipos.all %}
                            <a href="#" class="mm-link">{{ tipo.nombre }}</a>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            <div class="nav-item"><a href="#" class="nav-link" style="color:#ffd54f;">OFERTAS</a></div>
        </nav>
    </header>

    {% if not query %}
        <section class="wow-hero">
            <div class="hero-content">
                <h1>Tu estilo, tu universo.</h1>
                <p>Lo mejor en belleza y tecnología a precios increíbles.</p>
            </div>
            <div class="hero-wave"><svg viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M985.66,92.83C906.67,72,823.78,31,437.87,23.5,108.93,18.89,0,88.66,0,88.66V120H1200V95.6C1131.19,112.52,1048.87,109.54,985.66,92.83Z"></path></svg></div>
        </section>

        <section class="slider-section">
            <h2 class="slider-title"><i class="fas fa-sparkles"></i> Últimas Novedades <i class="fas fa-sparkles"></i></h2>
            <div style="position:relative;">
                <button class="slider-btn prev-btn" onclick="scrollSlider(-1)"><i class="fas fa-chevron-left"></i></button>
                <div class="slider-container" id="newArrivalsSlider">
                    {% for p in productos|slice:":6" %}
                    <div class="slider-card">
                        {% if p.imagen %}<img src="{{ p.imagen.url }}" class="product-img" alt="{{ p.nombre }}">{% else %}<div class="no-img"><i class="fas fa-camera"></i></div>{% endif %}
                        <div class="product-info" style="padding:15px;">
                            <div class="category-stack">
                                {% if p.tipo %}
                                    <span class="sub-tag">{{ p.tipo.subcategoria.nombre }}</span>
                                    <span class="type-tag">{{ p.tipo.nombre }}</span>
                                {% else %}
                                    <span class="sub-tag">General</span>
                                {% endif %}
                            </div>
                            <div class="product-title" style="font-size:0.95rem;">{{ p.nombre }}</div>
                            <div class="product-price" style="font-size:1.2rem; margin-bottom:10px;">${{ p.precio }}</div>
                            <a href="#catalogo" style="text-decoration:none; color:#ff4b9a; font-weight:700; font-size:0.9rem;">Ver más</a>
                        </div>
                    </div>
                    {% empty %}
                        <p style="text-align:center; width:100%;">Pronto nuevas novedades...</p>
                    {% endfor %}
                </div>
                <button class="slider-btn next-btn" onclick="scrollSlider(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <div class="section-separator">
            <div class="separator-line"></div>
            <div class="separator-content"><i class="fas fa-star"></i>Explora todo nuestro Catálogo<i class="fas fa-star"></i></div>
            <div class="separator-line"></div>
        </div>
    {% else %}
        <div class="search-header-container">
            <h2 class="search-title">BUSCAR RESULTADOS PARA "{{ query }}"</h2>
            <span class="search-count">({{ productos|length }} productos encontrados)</span>
        </div>
    {% endif %}

    <div class="container catalog-wrapper" id="catalogo">
        <aside class="filter-sidebar">
            <div style="margin-bottom:20px; font-weight:700; font-size:1.1rem; color:#333;"><i class="fas fa-sliders-h"></i> Filtrar por</div>
            
            {% for cat in categorias %}
            <details class="filter-group" open>
                <summary>{{ cat.nombre }}</summary>
                {% for sub in cat.subcategorias.all %}
                    <div class="sub-level-title">{{ sub.nombre }}</div>
                    {% for tipo in sub.tipos.all %}
                    <div class="checkbox-item">
                        <input type="checkbox" id="tipo_{{ tipo.id }}">
                        <label for="tipo_{{ tipo.id }}" class="checkbox-label">{{ tipo.nombre }}</label>
                    </div>
                    {% endfor %}
                {% endfor %}
            </details>
            {% endfor %}

            <details class="filter-group" open>
                <summary>Precio</summary>
                <div class="price-slider-container">
                    <input type="range" min="0.25" max="50.00" step="0.25" value="10.00" class="range-slider" id="priceRange">
                    <div class="price-values"><span id="priceValue">$10.00</span></div>
                </div>
            </details>
        </aside>

        <main>
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-size:0.9rem; color:#666; align-items:center;">
                {% if not query %}<span>Mostrando {{ productos|length }} productos</span>{% endif %}
                <div style="display:flex; align-items:center; gap:10px; margin-left:auto;">
                    <label style="font-weight:600;">Ordenar:</label>
                    <select style="border:1px solid #ddd; padding:8px 15px; border-radius:50px; outline:none; background:white; color:#555;">
                        <option>Relevancia</option>
                        <option>Precio: Bajo a Alto</option>
                        <option>Precio: Alto a Bajo</option>
                    </select>
                </div>
            </div>

            <div class="products-grid">
                {% for p in productos %}
                <div class="product-card">
                    <button class="btn-fav-card" onclick="this.classList.toggle('active')"><i class="fas fa-heart"></i></button>
                    {% if p.imagen %}<img src="{{ p.imagen.url }}" class="product-img" alt="{{ p.nombre }}">{% else %}<div class="no-img"><i class="fas fa-camera fa-2x"></i></div>{% endif %}
                    <div class="product-info">
                        <div class="category-stack">
                            {% if p.tipo %}
                                <span class="sub-tag">{{ p.tipo.subcategoria.nombre }}</span>
                                <span class="type-tag">{{ p.tipo.nombre }}</span>
                            {% else %}
                                <span class="sub-tag">General</span>
                            {% endif %}
                        </div>
                        <div class="product-title" title="{{ p.nombre }}">{{ p.nombre }}</div>
                        <div class="product-price">${{ p.precio }}</div>
                        
                        {% if user.is_authenticated %}
                            <form action="{% url 'agregar_carrito' p.id %}" method="post" style="margin-top:auto;">
                                {% csrf_token %}
                                <div class="qty-container">
                                    <label for="qty-{{ p.id }}">Cant:</label>
                                    <input type="number" id="qty-{{ p.id }}" name="cantidad" value="1" min="1" max="99" class="qty-input-card">
                                </div>
                                <button type="submit" class="btn-add-pink">AGREGAR</button>
                            </form>
                        {% else %}
                            <a href="{% url 'login' %}" class="btn-buy-locked">
                                <i class="fas fa-lock"></i> Inicia sesión
                            </a>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                    <div class="no-results-state">
                        <div class="no-results-icon"><i class="far fa-sad-tear"></i></div>
                        <div class="no-results-text">No encontramos productos para "{{ query }}"</div>
                        <p>Intenta con otra palabra o navega por nuestro menú.</p>
                        <a href="/" class="btn-reset-search">Ver todo el catálogo</a>
                    </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <footer class="site-footer">© 2026 Adrivo R. - Hecho con <i class="fas fa-heart" style="color:#ff4b9a"></i></footer>

    <script>
        const slider = document.getElementById("priceRange");
        const output = document.getElementById("priceValue");
        if(slider){ slider.oninput = function() { output.innerHTML = "$" + parseFloat(this.value).toFixed(2); }}
        
        function scrollSlider(direction) {
            const container = document.getElementById('newArrivalsSlider');
            if(container) container.scrollBy({ left: 240 * direction, behavior: 'smooth' });
        }
        setTimeout(() => { document.querySelectorAll('.notification-toast').forEach(e => e.style.display='none'); }, 3000);
    </script>
</body>
</html>